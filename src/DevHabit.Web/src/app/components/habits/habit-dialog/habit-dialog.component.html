<h2 mat-dialog-title>{{ data ? 'Edit Habit' : 'New Habit' }}</h2>
<form (ngSubmit)="onSave()">
  <mat-dialog-content>
    <!-- Name -->
    <mat-form-field appearance="fill" style="width: 100%; margin-top: 10px;">
      <mat-label>Name</mat-label>
      <input matInput name="name" [(ngModel)]="habitData.name" required>
    </mat-form-field>

    <div style="display: flex; gap: 15px;">
      <!-- Type Selection -->
      <mat-form-field appearance="fill" style="flex: 1;">
        <mat-label>Type</mat-label>
        <mat-select name="type" [(ngModel)]="habitData.type">
          <mat-option [value]="1">Binary (Yes/No)</mat-option>
          <mat-option [value]="2">Measurable (Count)</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Frequency -->
      <mat-form-field appearance="fill" style="flex: 1;">
        <mat-label>Frequency</mat-label>
        <mat-select name="freqType" [(ngModel)]="habitData.frequency.type">
          <mat-option [value]="1">Daily</mat-option>
          <mat-option [value]="2">Weekly</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Target (Only for Measurable) -->
    @if (habitData.type === 2) {
      <div style="display: flex; gap: 15px;">
        <mat-form-field appearance="fill" style="flex: 1;">
          <mat-label>Target Value</mat-label>
          <input matInput type="number" name="targetValue" [(ngModel)]="habitData.target.value">
        </mat-form-field>
        
        <mat-form-field appearance="fill" style="flex: 1;">
          <mat-label>Unit</mat-label>
          <mat-select name="unit" [(ngModel)]="habitData.target.unit">
            @for (unit of allowedUnits; track unit) {
              <mat-option [value]="unit">{{ unit }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
    }

    <!-- Description -->
    <mat-form-field appearance="fill" style="width: 100%;">
      <mat-label>Description</mat-label>
      <textarea matInput name="description" [(ngModel)]="habitData.description" rows="2"></textarea>
    </mat-form-field>

    <!-- Tag Selection -->
    <mat-form-field appearance="fill" style="width: 100%;">
      <mat-label>Tags</mat-label>
      <mat-select name="tags" [(ngModel)]="selectedTagIds" multiple>
        @for (tag of allTags; track tag.id) {
          <mat-option [value]="tag.id">{{ tag.name }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button type="button" (click)="onCancel()">Cancel</button>
    <button mat-raised-button color="primary" type="submit" [disabled]="!habitData.name">Save</button>
  </mat-dialog-actions>
</form>